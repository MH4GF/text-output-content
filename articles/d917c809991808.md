---
title: "M1 Macã§Docker/Ruby on Rails/Go/Nodeã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰ãƒ¡ãƒ¢"
emoji: "ğŸ¦”"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: []
published: false
---
# ã¯ã˜ã‚ã«

è¡¨é¡Œã®é€šã‚Šæ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚ä»Šå›ã®è¨˜äº‹ã§ã¯Macã®åˆæœŸåŒ–çŠ¶æ…‹ã‹ã‚‰é–‹ç™ºãŒå§‹ã‚ã‚‰ã‚Œã‚‹ã¾ã§ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…å®¹ã¨ã€M1ç’°å¢ƒã«ãŠã„ã¦è©°ã¾ã£ãŸã¨ã“ã‚ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚  
2021/4/29ã«ç’°å¢ƒæ§‹ç¯‰ã—ã€ã“ã®ç’°å¢ƒã§æ‰€å±ã—ã¦ã„ã‚‹ä¼šç¤¾ã®é–‹ç™ºã«1ãƒ¶æœˆã»ã©å¾“äº‹ã—ã¦ã„ã¾ã™ãŒã€ä»Šã®ã¨ã“ã‚ç‰¹ã«å•é¡Œã‚‚ãªãé–‹ç™ºã§ãã¦ã„ã¾ã™ã€‚ä»Šå¾Œã‚‚ç¶™ç¶šã—ã¦M1ç’°å¢ƒã§é–‹ç™ºã™ã‚‹ã¤ã‚‚ã‚Šã§ã™ã€‚  
M1ã®æ¤œè¨¼è¨˜äº‹ã¯ãªã‚“ã¼ã‚ã£ã¦ã‚‚ã„ã„ã§ã™ã‹ã‚‰ã­ã€‚ä»–ã®è¨˜äº‹ã¨ã®é‡è¤‡ã‚’æ°—ã«ã›ãšè¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚  

# ä»Šå›ã®ç’°å¢ƒ

- Homebrew, Rosetta 2ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚
- Rubyã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã¯Docker for Macã‚’åˆ©ç”¨ã—Dockerä¸Šã§å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚
- Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯docker-composeã§ç«‹ã¡ä¸Šã’ã€Rails, MySQL, Redis, Sidekiqã‚’å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚
- Go/Nodeã¯anyenvã‚’åˆ©ç”¨ã—ãƒ›ã‚¹ãƒˆãƒã‚·ãƒ³ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚

# Macã®ãƒªã‚¹ãƒˆã‚¢ãƒ»ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

è‡ªåˆ†ã¯Macã‚’å®šæœŸçš„ã«å·¥å ´å‡ºè·çŠ¶æ…‹ã«æˆ»ã—ãŸã„æ°‘ã§ã€Brewfileã‚„ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ã€‚  
```
#!/bin/sh

ARCH=$(uname -m)
NODE_VERISON=16.0.0
GO_VERSION=1.16.3

xcode-select --install

echo "HomebrewãŒãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
if [ ! -x "`which brew`" ]; then
  echo "ãªã„ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å§‹ã‚ã¾ã™"
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  
  # M1ã®å ´åˆpathã‚’é€šã™å¿…è¦ãŒã‚ã‚‹
  if [ $ARCH == "arm64" ]; then
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
    eval "$(/opt/homebrew/bin/brew shellenv)"
  fi
  brew update
  brew upgrade
  brew -v
fi
brew doctor

echo "DropboxãŒãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
if [ ! -e /Applications/Dropbox.app ]; then
  echo "ãªã‹ã£ãŸã®ã§Dropboxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
  brew install --cask dropbox
  echo "DropboxãŒé–‹ãã®ã§ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãƒ•ã‚¡ã‚¤ãƒ«åŒæœŸã—ã¦ãã ã•ã„ã€‚åŒæœŸãŒçµ‚äº†ã—ãŸã‚‰yã§æ¬¡ã«é€²ã‚“ã§ãã ã•ã„ã€‚"
  open -a /Applications/Dropbox.app
  read -p "sync file succeeded? (y/N): " yn
  case "$yn" in [yY]*) ;; *) echo "abort." ; exit ;; esac
fi

echo "å„ç¨®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹"
~/Dropbox/backup/setup.sh

echo "Brewfileã‚’Gistã‹ã‚‰å–å¾—ã™ã‚‹"
curl -fsSL https://gist.githubusercontent.com/MH4GF/c945f8e7654dcf1db7a2928885068167/raw > ~/.Brewfile

echo "brewã§å„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
brew bundle --global

echo "Dotfilesã‚’cloneã—ã¦ãã¦ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’è²¼ã‚‹"
ghq get --update git@github.com:MH4GF/dotfiles.git
~/.ghq/github.com/MH4GF/dotfiles/setup.sh

if [ ! -e ~/.oh-my-zsh/ ]; then
  echo "oh-my-zshã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
  rm -rf ~/.oh-my-zsh
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  echo "loading zsh_profile..."
  echo "source ~/.zsh_profile" >> ~/.zshrc
fi

echo "XXenvç³»ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
if [ ! -x "`which node`" ]; then
  echo "nodenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
  anyenv install nodenv
  exec $SHELL -l
  nodenv install $NODENV_VERSION
  nodenv global $NODENV_VERSION
fi
node -v

if [ ! -x "`which go`" ]; then
  echo "goenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
  anyenv install goenv
  exec $SHELL -l
  goenv install $NODENV_VERSION
  goenv global $NODENV_VERSION
  goenv rehash
fi
go version

echo "npmä¾å­˜ã®ãƒ„ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
npm install -g yarn
npm install -g commitizen

# Finder
## ~/Library ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
chflags nohidden ~/Library

## /Volumes ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¦‹ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹
sudo chflags nohidden /Volumes

## ãƒ–ãƒ¼ãƒˆæ™‚ã®ã‚µã‚¦ãƒ³ãƒ‰ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹
sudo nvram SystemAudioVolume=" "

## éš ã—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹
defaults write com.apple.finder AppleShowAllFiles TRUE

## å…¨ã¦ã®æ‹¡å¼µå­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤º
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

## æ¤œç´¢æ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ¤œç´¢
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# âŒ˜ + Q ã§ã®çµ‚äº†ã‚’è¨±å¯
defaults write com.apple.finder QuitMenuItem -bool true

killall Finder

# ã‚­ãƒ¼ãƒªãƒ”ãƒ¼ãƒˆ
defaults write -g InitialKeyRepeat -int 12
defaults write -g KeyRepeat -int 1

## ä»£ç”¨æ–‡å­—å…¥åŠ›ã‚’ã‚ªãƒ•ã«
defaults write -g ApplePressAndHoldEnabled -bool false

# Dock ã«æ¨™æº–ã§å…¥ã£ã¦ã„ã‚‹Finder ã¨ã”ã¿ç®±ä»¥å¤–ã®å…¨ã¦ã®ã‚¢ãƒ—ãƒªã‚’æ¶ˆã™
defaults write com.apple.dock persistent-apps -array

# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼
## å„ç¨®è¡¨ç¤º
defaults write com.apple.systemuiserver menuExtras -array \
    "/System/Library/CoreServices/Menu\ Extras/Bluetooth.menu" \
    "/System/Library/CoreServices/Menu\ Extras/AirPort.menu" \
    "/System/Library/CoreServices/Menu\ Extras/Volume.menu" \
    "/System/Library/CoreServices/Menu\ Extras/Battery.menu" \
    "/System/Library/CoreServices/Menu\ Extras/TextInput.menu" \
    "/System/Library/CoreServices/Menu\ Extras/Clock.menu"
    
killall -kill SystemUIServer
```
https://gist.github.com/MH4GF/83cd437393caa30afb3ea48807320f03  
ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãªgistã«ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç½®ã„ã¦ãŠãã“ã¨ã§ã€Macã‚’åˆæœŸåŒ–ã—ãŸçŠ¶æ…‹ã§ã‚‚ã™ãã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å‡¦ç†ãŒå§‹ã‚ã‚‰ã‚Œã¦ä¾¿åˆ©ã§ã™ã€‚  
Dropboxã«sshã‚­ãƒ¼ã‚„è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ã„ã‚‹ãŸã‚åƒ•ä»¥å¤–ã®ç’°å¢ƒã§ã¯å‹•ã‹ã›ã¾ã›ã‚“ãŒã€ãŠãã‚‰ãã©ã®ã‚ˆã†ãªå‡¦ç†ã‚’ã—ã¦ã„ã‚‹ã®ã‹ã¯ç†è§£ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚  
ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å‡¦ç†å†…å®¹ã¨ã—ã¦ã¯ã–ã£ãã‚Šä»¥ä¸‹ã§ã™ã€‚  

1. Xcode, brewã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. Dropboxã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€sshã‚­ãƒ¼ã‚„gitã®è¨­å®š
3. gistã«ç½®ã„ã¦ã„ã‚‹Brewfileã‚’å–å¾—ã—å„ç¨®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
4. anyenvã‚’åˆ©ç”¨ã—ã¦Node/Goã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
5. defaultsã‚³ãƒãƒ³ãƒ‰ãªã©Macã®è¨­å®šå¤‰æ›´

ç‰¹ç­†ã™ã¹ãå†…å®¹ã‚’ãã‚Œãã‚Œãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ã€‚

## Homebrewã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Homebrewã«ã¤ã„ã¦ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³3.0.0ã§æ­£å¼ã«Apple SiliconãŒã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚  
Intelç‰ˆã¨ã®é•ã„ãŒã‚ã‚‹ã¨ã™ã‚Œã°åˆ¥ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãŸã‚ãƒ‘ã‚¹ã‚’é€šã™å¿…è¦ãŒã‚ã‚‹ç¨‹åº¦ã§ã™ã€‚

```
echo "HomebrewãŒãªã‘ã‚Œã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
if [ ! -x "`which brew`" ]; then
  echo "ãªã„ã®ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å§‹ã‚ã¾ã™"
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  
  # M1ã®å ´åˆpathã‚’é€šã™å¿…è¦ãŒã‚ã‚‹
  if [ $ARCH == "arm64" ]; then
    echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> ~/.zprofile
    eval "$(/opt/homebrew/bin/brew shellenv)"
  fi
  brew update
  brew upgrade
  brew -v
fi
brew doctor
```

## Brewfileã‚’åˆ©ç”¨ã—ãŸå„ç¨®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
echo "Brewfileã‚’Gistã‹ã‚‰å–å¾—ã™ã‚‹"
curl -fsSL https://gist.githubusercontent.com/MH4GF/c945f8e7654dcf1db7a2928885068167/raw > ~/.Brewfile

echo "brewã§å„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
brew bundle --global
```

`brew bundle` ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦å„ç¨®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
Brewfileã®ä¸­èº«ã¯ç¾åœ¨ã“ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

```
tap 'homebrew/cask'
tap 'homebrew/cask-versions'
tap 'homebrew/core'
tap 'homebrew/bundle'
tap 'mh4gf/cleanup'

brew 'git'
brew 'tig'
brew 'ghq'
brew 'peco'
brew 'jq'
brew 'awscli'
brew 'versent/taps/saml2aws'
brew 'anyenv'
brew 'MH4GF/cleanup/cleanup'

cask 'slack'
cask 'clipy'
cask 'karabiner-elements'
cask 'skitch'
cask 'google-chrome'
cask 'iterm2'
cask 'docker'
cask 'google-drive-file-stream'
cask 'adobe-creative-cloud'
cask 'bettertouchtool'
cask '1password'
cask 'intellij-idea'
cask 'goland'
cask 'rubymine'
cask 'webstorm'
cask 'figma'
cask 'deepl'

mas 'LINE', id: 539_883_307
```

ã¾ãšbrewçµŒç”±ã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§å¤±æ•—ã—ãŸã®ã¯saml2awsã®ã¿ã§ã—ãŸã€‚  
ã¨ã¯ã„ãˆã©å¾Œè¿°ã™ã‚‹Goã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒçµ‚ã‚ã£ãŸå¾Œãƒªãƒã‚¸ãƒˆãƒªã‚’cloneã—ã¦ãã¦ `make install` ã‚’æ‰“ã¦ã°è§£æ±ºã—ã¾ã—ãŸã€‚  
ã“ã®ã‚ˆã†ã«ã€ã‚ã‚‹ç¨‹åº¦ä¸€èˆ¬çš„ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã¯M1ç’°å¢ƒã§ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«è‡ªä½“ã¯ã§ãã‚‹ã‚‚ã®ã¨æ€ã£ã¦è‰¯ã„ã§ã—ã‚‡ã†ã€‚åƒ•ã‚‚ã“ã“ã§ã‹ãªã‚Šè©°ã¾ã‚‹ã ã‚ã†ã¨æƒ³å®šã—ã¦ã„ãŸã®ã§æ„å¤–ã§ã—ãŸã€‚

### ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å®Ÿè¡Œã‚„Rosetta2å‘¨ã‚Š

ä¸Šè¨˜ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®ã†ã¡ã€èµ·å‹•ãƒ»å®Ÿè¡Œã«å¤±æ•—ã—ãŸã‚‚ã®ã‚‚ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚  
ã‚‚ã¡ã‚ã‚“Intelç‰ˆã—ã‹å¯¾å¿œã—ã¦ã„ãªã„ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã«ã¤ã„ã¦ã¯èµ·å‹•æ™‚ã«Rosetta2ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã™ã€‚

ã¾ãŸã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã®å…¬å¼ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ç­‰ã§ã¯Apple Siliconç‰ˆã®å¯¾å¿œãƒã‚¤ãƒŠãƒªãŒã‚ã‚‹ã®ã«ã€brewçµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸå ´åˆIntelç‰ˆãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã—ã¾ã£ãŸã€ã¨ã„ã†ã“ã¨ã‚‚ã‚ˆãã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯Homebrewã‚„Homebrew-caskãŒApple Siliconç‰ˆã¸ã®å¯¾å¿œãŒã§ãã¦ã„ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚  
ä»Šå›RubyMineã®ä¿®æ­£å¯¾å¿œã§Pull Requestã‚’å‡ºã—ã¦ã¿ã¾ã—ãŸãŒã™ãã«ãƒãƒ¼ã‚¸ã•ã‚Œã¾ã—ãŸã€‚  
ä¿®æ­£ã¯ãã“ã¾ã§é›£ã—ããªã‹ã£ãŸãŸã‚ã€ä½¿ã£ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ãŒbrewã§å¯¾å¿œã—ã¦ã„ãªã‹ã£ãŸå ´åˆã¯ãœã²Pull Requestã‚’å‡ºã—ã¦ã¿ã¦ãã ã•ã„ã€‚

https://github.com/Homebrew/homebrew-cask/pull/105117

## Node/Goã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
è‡ªåˆ†ã¯Node/Goã«ã¤ã„ã¦ã¯anyenvã‚’åˆ©ç”¨ã—ã¦Macã«ç›´æ¥ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã¡ã‚‰ã«ã¤ã„ã¦ã¯Intelç‰ˆã®Macã¨ä½•ã‚‚å¤‰ã‚ã‚‰ãšç’°å¢ƒæ§‹ç¯‰ã¨å®Ÿè¡ŒãŒã§ãã¾ã—ãŸã€‚

```
echo "XXenvç³»ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
if [ ! -x "`which node`" ]; then
  echo "nodenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
  anyenv install nodenv
  exec $SHELL -l
  nodenv install $NODENV_VERSION
  nodenv global $NODENV_VERSION
fi
node -v

if [ ! -x "`which go`" ]; then
  echo "goenvã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
  anyenv install goenv
  exec $SHELL -l
  goenv install $NODENV_VERSION
  goenv global $NODENV_VERSION
  goenv rehash
fi
go version
```

# docker-composeã§ã®Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ç’°å¢ƒæ§‹ç¯‰

Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¤ã„ã¦ã¯Intelç‰ˆMacã§ã‚ã£ã¦ã‚‚docker-composeã§ç’°å¢ƒæ§‹ç¯‰ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚ä»Šå›ã‚‚docker-composeã§ç«‹ã¡ä¸Šã’ã¾ã™ã€‚èµ·å‹•ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã¯ä»¥ä¸‹ã§ã€ã‚ã‚‹ç¨‹åº¦ä¸€èˆ¬çš„ãªæ§‹æˆã ã¨æ€ã‚ã‚Œã¾ã™ã€‚

- pumaã§èµ·å‹•ã™ã‚‹Railsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- MySQL5.7
- Redis5.0
- Sidekiq

ã“ã“ã‹ã‚‰ã¯ç«‹ã¡ä¸Šã’é€”ä¸­ã§è©°ã¾ã£ãŸç®‡æ‰€ã«ã¤ã„ã¦ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ã„ãã¾ã™ã€‚

## mysqlã‚¤ãƒ¡ãƒ¼ã‚¸ã®pullã«å¤±æ•—

```
Pulling mysql (mysql:5.7)...
5.7: Pulling from library/mysql
ERROR: no matching manifest for linux/arm64/v8 in the manifest list entries
```
ã“ã‚Œã¯Dockerå…¬å¼ã§ã‚‚æ—¢çŸ¥ã®å•é¡Œã§ã‚ã‚Šã€[MySQLã‚¤ãƒ¡ãƒ¼ã‚¸ã¯armã«å¯¾å¿œã—ã¦ã„ãªã„ã¨ã®ã“ã¨ã€‚](https://docs.docker.com/docker-for-mac/apple-silicon/)


> the mysql image is not available for ARM64. You can work around this issue by using a mariadb image.

ã“ã¡ã‚‰ã«ã¤ã„ã¦ã¯docker-compose.ymlã®serviceã«ã¦ `platform: linux/x86_64` ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§pullã¨èµ·å‹•ã«æˆåŠŸã—ã¾ã—ãŸã€‚  
https://stackoverflow.com/questions/65456814/docker-apple-silicon-m1-preview-mysql-no-matching-manifest-for-linux-arm64-v8

## rails serverèµ·å‹•å¾Œã€ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã« symbol lookup errorãŒå‡ºã‚‹

```
app_1      | Started GET "/login" for 172.18.0.1 at 2021-05-05 10:10:15 +0900
app_1      |    (2.1ms)  SET NAMES utf8mb4 COLLATE utf8mb4_bin,  @@SESSION.sql_mode = CONCAT(CONCAT(@@sql_mode, ',STRICT_ALL_TABLES'), ',NO_AUTO_VALUE_ON_ZERO'),  @@SESSION.sql_auto_is_null = 0, @@SESSION.wait_timeout = 2147483
app_1      |    (1.4ms)  SELECT `schema_migrations`.`version` FROM `schema_migrations` ORDER BY `schema_migrations`.`version` ASC
app_1      | Processing by SessionsController#new as HTML
app_1      |   Rendering devise/sessions/new.html.slim 
app_1      |   Rendered devise/sessions/new.html.slim (Duration: 9.7ms | Allocations: 9394)
app_1      | puma 3.12.6 (tcp://0.0.0.0:3000) [app]: symbol lookup error: /usr/local/bundle/gems/ffi-1.15.0/lib/ffi_c.so: undefined symbol: pthread_atfork
hogehoge_app_1 exited with code 127
```

ã“ã¡ã‚‰ã¯ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã‚ã‚‹ffiã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ1.15.0ã ã¨èµ·ã“ã‚‹ã‚ˆã†ã§ã€ä»¥ä¸‹ã®issueã®ã‚ˆã†ã«